{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport Axios from 'axios';\nimport { BASE_URL } from \"../utils/constant\";\nimport { parseJwt } from \"../utils/parseToken\";\nimport { save } from \"../utils/Storage\";\nimport { apiInstance } from \"./index\";\nimport NavigationService from \"../constants/NavigationService\";\nimport { navigationStrings } from \"../constants\";\nimport { removeTokens } from \"../redux/actions/user\";\nexport function setToken(token) {\n  Object.assign(apiInstance.defaults.headers, {\n    Authorization: `Bearer ${token}`\n  });\n}\nexport function removeToken() {\n  delete apiInstance.defaults.headers.Authorization;\n}\nexport function getToken() {\n  if (apiInstance.defaults.headers.Authorization && apiInstance.defaults.headers.Authorization.toLowerCase().indexOf(\"bearer\") != -1) {\n    return apiInstance.defaults.headers.Authorization.split(\" \")[1];\n  }\n  return \"\";\n}\nexport function handleRequest(_x) {\n  return _handleRequest.apply(this, arguments);\n}\nfunction _handleRequest() {\n  _handleRequest = _asyncToGenerator(function* (request) {\n    if (__DEV__) {}\n    var login_token = yield getToken();\n    if (login_token) {\n      var decodedJwt = parseJwt(login_token);\n      if (Math.floor(new Date().getTime() / 1000) >= (decodedJwt == null ? void 0 : decodedJwt.exp) - 6 * 60) {\n        yield fetch(`${BASE_URL}refresh-token`, {\n          method: 'GET',\n          headers: {\n            Authorization: `Bearer ${login_token}`\n          }\n        }).then(function (r) {\n          return r.json();\n        }).then(function () {\n          var _ref = _asyncToGenerator(function* (response) {\n            if ((response == null ? void 0 : response.status) === 1) {\n              yield setToken(response == null ? void 0 : response.jwt_token);\n              request.headers.Authorization = `Bearer ${response == null ? void 0 : response.jwt_token}`;\n            } else {\n              yield removeTokens();\n              NavigationService.resetNavigation(navigationStrings.AUTHSTACK);\n            }\n          });\n          return function (_x3) {\n            return _ref.apply(this, arguments);\n          };\n        }()).catch(function (e) {\n          console.log('renew_token_error 47---->', JSON.stringify(e));\n        });\n        return request;\n      }\n    }\n    return request;\n  });\n  return _handleRequest.apply(this, arguments);\n}\nexport function handleResponse(value) {\n  return value;\n}\nexport function handleApiError(_x2) {\n  return _handleApiError.apply(this, arguments);\n}\nfunction _handleApiError() {\n  _handleApiError = _asyncToGenerator(function* (error) {\n    console.log('-------------errr', error == null ? void 0 : error.response);\n    if (Axios.isCancel(error)) {\n      console.log('Canceled');\n      throw error;\n    }\n    if (__DEV__) {}\n    if (!error.response) {\n      throw error;\n    }\n    if (error.response.status === 401) {\n      return;\n    } else if (error.response.status === 500) {\n      console.log('Server error has occurred. Please try again later');\n      throw error;\n    } else {}\n    throw error;\n  });\n  return _handleApiError.apply(this, arguments);\n}","map":{"version":3,"names":["Axios","BASE_URL","parseJwt","save","apiInstance","NavigationService","navigationStrings","removeTokens","setToken","token","Object","assign","defaults","headers","Authorization","removeToken","getToken","toLowerCase","indexOf","split","handleRequest","_x","_handleRequest","apply","arguments","_asyncToGenerator","request","__DEV__","login_token","decodedJwt","Math","floor","Date","getTime","exp","fetch","method","then","r","json","_ref","response","status","jwt_token","resetNavigation","AUTHSTACK","_x3","catch","e","console","log","JSON","stringify","handleResponse","value","handleApiError","_x2","_handleApiError","error","isCancel"],"sources":["/Users/dhavalpatel/Documents/ExpoApp/src/httpClient/ClientHelper.js"],"sourcesContent":["import Axios from 'axios';\nimport { BASE_URL } from '../utils/constant';\nimport { parseJwt } from '../utils/parseToken';\nimport { save } from '../utils/Storage';\nimport { apiInstance } from './index';\nimport NavigationService from '../constants/NavigationService';\nimport { navigationStrings } from '../constants';\nimport { removeTokens } from '../redux/actions/user';\n\nexport function setToken(token) {\n  Object.assign(apiInstance.defaults.headers, {\n    Authorization: `Bearer ${token}`,\n  });\n}\nexport function removeToken() {\n  delete apiInstance.defaults.headers.Authorization;\n}\n\nexport function getToken() {\n  if (\n    apiInstance.defaults.headers.Authorization &&\n    apiInstance.defaults.headers.Authorization\n      .toLowerCase()\n      .indexOf(\"bearer\") != -1\n  ) {\n    return apiInstance.defaults.headers.Authorization.split(\" \")[1];\n  }\n  return \"\";\n}\nexport async function handleRequest(request) {\n  if (__DEV__) {\n    // console.log('REQUEST', request);\n  }\n\n  let login_token = await getToken();\n  if (login_token) {\n    let decodedJwt = parseJwt(login_token);\n    if ((Math.floor((new Date).getTime() / 1000)) >= decodedJwt?.exp - (6 * 60)) {\n      await fetch(`${BASE_URL}refresh-token`, {\n        method: 'GET',\n        headers: {\n          Authorization: `Bearer ${login_token}`,\n        },\n      })\n        .then(r => r.json())\n        .then(async response => {\n          if (response?.status === 1) {\n            await setToken(response?.jwt_token);\n            request.headers.Authorization = `Bearer ${response?.jwt_token}`;\n          } else {\n            await removeTokens();\n            NavigationService.resetNavigation(navigationStrings.AUTHSTACK);\n          }\n        })\n        .catch(e => {\n          console.log(\n            'renew_token_error 47---->',\n            JSON.stringify(e),\n          );\n        });\n      return request;\n    }\n  }\n  return request;\n}\nexport function handleResponse(value) {\n  return value;\n}\nexport async function handleApiError(error) {\n  console.log('-------------errr',error?.response)\n  if (Axios.isCancel(error)) {\n    console.log('Canceled');\n    throw error;\n  }\n  if (__DEV__) {\n    // console.log('handleApiError------>', error);\n  }\n  if (!error.response) {\n    throw error;\n  }\n  if (error.response.status === 401) {\n    return;\n  } else if (error.response.status === 500) {\n    console.log('Server error has occurred. Please try again later');\n    throw error;\n  } else {\n    // showToast(error.toString());\n  }\n  throw error;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}