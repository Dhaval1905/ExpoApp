{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";var _handleRequest,_handleApiError;import Axios from'axios';import{BASE_URL}from\"../utils/constant\";import{parseJwt}from\"../utils/parseToken\";import{save}from\"../utils/Storage\";import{apiInstance}from\"./index\";import NavigationService from\"../constants/NavigationService\";import{navigationStrings}from\"../constants\";import{removeTokens}from\"../redux/actions/user\";export function setToken(token){Object.assign(apiInstance.defaults.headers,{Authorization:`Bearer ${token}`});}export function removeToken(){delete apiInstance.defaults.headers.Authorization;}export function getToken(){if(apiInstance.defaults.headers.Authorization&&apiInstance.defaults.headers.Authorization.toLowerCase().indexOf(\"bearer\")!=-1){return apiInstance.defaults.headers.Authorization.split(\" \")[1];}return\"\";}export function handleRequest(_x){return(_handleRequest=_handleRequest||_asyncToGenerator(function*(request){if(__DEV__){}var login_token=yield getToken();if(login_token){var decodedJwt=parseJwt(login_token);if(Math.floor(new Date().getTime()/1000)>=(decodedJwt==null?void 0:decodedJwt.exp)-6*60){var _ref;yield fetch(`${BASE_URL}refresh-token`,{method:'GET',headers:{Authorization:`Bearer ${login_token}`}}).then(function(r){return r.json();}).then(function(_x2){return(_ref=_ref||_asyncToGenerator(function*(response){if((response==null?void 0:response.status)===1){yield setToken(response==null?void 0:response.jwt_token);request.headers.Authorization=`Bearer ${response==null?void 0:response.jwt_token}`;}else{yield removeTokens();NavigationService.resetNavigation(navigationStrings.AUTHSTACK);}})).apply(this,arguments);}).catch(function(e){console.log('renew_token_error 47---->',JSON.stringify(e));});return request;}}return request;})).apply(this,arguments);}export function handleResponse(value){return value;}export function handleApiError(_x3){return(_handleApiError=_handleApiError||_asyncToGenerator(function*(error){console.log('-------------errr',error==null?void 0:error.response);if(Axios.isCancel(error)){console.log('Canceled');throw error;}if(__DEV__){}if(!error.response){throw error;}if(error.response.status===401){return;}else if(error.response.status===500){console.log('Server error has occurred. Please try again later');throw error;}else{}throw error;})).apply(this,arguments);}","map":{"version":3,"names":["Axios","BASE_URL","parseJwt","save","apiInstance","NavigationService","navigationStrings","removeTokens","setToken","token","Object","assign","defaults","headers","Authorization","removeToken","getToken","toLowerCase","indexOf","split","handleRequest","_x","_handleRequest","_asyncToGenerator","request","__DEV__","login_token","decodedJwt","Math","floor","Date","getTime","exp","_ref","fetch","method","then","r","json","_x2","response","status","jwt_token","resetNavigation","AUTHSTACK","apply","arguments","catch","e","console","log","JSON","stringify","handleResponse","value","handleApiError","_x3","_handleApiError","error","isCancel"],"sources":["/Users/dhavalpatel/Documents/ExpoApp/src/httpClient/ClientHelper.js"],"sourcesContent":["import Axios from 'axios';\nimport { BASE_URL } from '../utils/constant';\nimport { parseJwt } from '../utils/parseToken';\nimport { save } from '../utils/Storage';\nimport { apiInstance } from './index';\nimport NavigationService from '../constants/NavigationService';\nimport { navigationStrings } from '../constants';\nimport { removeTokens } from '../redux/actions/user';\n\nexport function setToken(token) {\n  Object.assign(apiInstance.defaults.headers, {\n    Authorization: `Bearer ${token}`,\n  });\n}\nexport function removeToken() {\n  delete apiInstance.defaults.headers.Authorization;\n}\n\nexport function getToken() {\n  if (\n    apiInstance.defaults.headers.Authorization &&\n    apiInstance.defaults.headers.Authorization\n      .toLowerCase()\n      .indexOf(\"bearer\") != -1\n  ) {\n    return apiInstance.defaults.headers.Authorization.split(\" \")[1];\n  }\n  return \"\";\n}\nexport async function handleRequest(request) {\n  if (__DEV__) {\n    // console.log('REQUEST', request);\n  }\n\n  let login_token = await getToken();\n  if (login_token) {\n    let decodedJwt = parseJwt(login_token);\n    if ((Math.floor((new Date).getTime() / 1000)) >= decodedJwt?.exp - (6 * 60)) {\n      await fetch(`${BASE_URL}refresh-token`, {\n        method: 'GET',\n        headers: {\n          Authorization: `Bearer ${login_token}`,\n        },\n      })\n        .then(r => r.json())\n        .then(async response => {\n          if (response?.status === 1) {\n            await setToken(response?.jwt_token);\n            request.headers.Authorization = `Bearer ${response?.jwt_token}`;\n          } else {\n            await removeTokens();\n            NavigationService.resetNavigation(navigationStrings.AUTHSTACK);\n          }\n        })\n        .catch(e => {\n          console.log(\n            'renew_token_error 47---->',\n            JSON.stringify(e),\n          );\n        });\n      return request;\n    }\n  }\n  return request;\n}\nexport function handleResponse(value) {\n  return value;\n}\nexport async function handleApiError(error) {\n  console.log('-------------errr',error?.response)\n  if (Axios.isCancel(error)) {\n    console.log('Canceled');\n    throw error;\n  }\n  if (__DEV__) {\n    // console.log('handleApiError------>', error);\n  }\n  if (!error.response) {\n    throw error;\n  }\n  if (error.response.status === 401) {\n    return;\n  } else if (error.response.status === 500) {\n    console.log('Server error has occurred. Please try again later');\n    throw error;\n  } else {\n    // showToast(error.toString());\n  }\n  throw error;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}