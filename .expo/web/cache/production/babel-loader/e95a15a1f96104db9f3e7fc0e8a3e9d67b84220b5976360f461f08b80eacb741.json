{"ast":null,"code":"\"use strict\";var _slicedToArray=require(\"@babel/runtime/helpers/slicedToArray\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=useIMGElementState;var _react=require(\"react\");var _reactNative=require(\"react-native-web/dist/index\");var _defaultInitialImageDimensions=_interopRequireDefault(require(\"./defaultInitialImageDimensions\"));var _useIMGNormalizedSource=_interopRequireDefault(require(\"./useIMGNormalizedSource\"));var _useImageConcreteDimensions=_interopRequireDefault(require(\"./useImageConcreteDimensions\"));var _getIMGState=require(\"./getIMGState\");var _useImageSpecifiedDimensions=_interopRequireDefault(require(\"./useImageSpecifiedDimensions\"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function getImageSizeAsync(_ref){var uri=_ref.uri,headers=_ref.headers;return new Promise(function(onsuccess,onerror){var onImageDimensionsSuccess=function onImageDimensionsSuccess(width,height){return onsuccess({width:width,height:height});};if(headers){_reactNative.Image.getSizeWithHeaders(uri,headers,onImageDimensionsSuccess,onerror);}else{_reactNative.Image.getSize(uri,onImageDimensionsSuccess,onerror);}});}function useImageNaturalDimensions(props){var source=props.source,cachedNaturalDimensions=props.cachedNaturalDimensions;var _ref2=(0,_react.useState)(cachedNaturalDimensions||null),_ref3=_slicedToArray(_ref2,2),naturalDimensions=_ref3[0],setNaturalDimensions=_ref3[1];var _ref4=cachedNaturalDimensions||{},cachedNaturalWidth=_ref4.width,cachedNaturalHeight=_ref4.height;var _ref5=(0,_react.useState)(null),_ref6=_slicedToArray(_ref5,2),error=_ref6[0],setError=_ref6[1];(0,_react.useEffect)(function resetOnURIChange(){setNaturalDimensions(cachedNaturalWidth!=null&&cachedNaturalHeight!=null?{width:cachedNaturalWidth,height:cachedNaturalHeight}:null);setError(null);},[cachedNaturalHeight,cachedNaturalWidth,source.uri]);return{onNaturalDimensions:setNaturalDimensions,onError:setError,naturalDimensions:naturalDimensions,error:error};}function useFetchedNaturalDimensions(props){var source=props.source,cachedNaturalDimensions=props.cachedNaturalDimensions;var _useImageNaturalDimen=useImageNaturalDimensions(props),error=_useImageNaturalDimen.error,naturalDimensions=_useImageNaturalDimen.naturalDimensions,onError=_useImageNaturalDimen.onError,onNaturalDimensions=_useImageNaturalDimen.onNaturalDimensions;var hasCachedDimensions=!!cachedNaturalDimensions;(0,_react.useEffect)(function fetchPhysicalDimensions(){var cancelled=false;if(source.uri&&!hasCachedDimensions){getImageSizeAsync({uri:source.uri,headers:source.headers}).then(function(dimensions){return!cancelled&&onNaturalDimensions(dimensions);}).catch(function(e){return!cancelled&&onError(e||{});});return function(){cancelled=true;};}},[source.uri,source.headers,onNaturalDimensions,onError,hasCachedDimensions]);return{naturalDimensions:naturalDimensions,error:error,onError:onError,onNaturalDimensions:onNaturalDimensions};}function useIMGElementState(props){var alt=props.alt,altColor=props.altColor,source=props.source,contentWidth=props.contentWidth,computeMaxWidth=props.computeMaxWidth,objectFit=props.objectFit,_props$initialDimensi=props.initialDimensions,initialDimensions=_props$initialDimensi===void 0?_defaultInitialImageDimensions.default:_props$initialDimensi,cachedNaturalDimensions=props.cachedNaturalDimensions;var _ref7=(0,_useImageSpecifiedDimensions.default)(props),flatStyle=_ref7.flatStyle,specifiedDimensions=_ref7.specifiedDimensions;var nomalizedSource=(0,_useIMGNormalizedSource.default)({specifiedDimensions:specifiedDimensions,source:source});var _useFetchedNaturalDim=useFetchedNaturalDimensions({source:nomalizedSource,specifiedDimensions:specifiedDimensions,cachedNaturalDimensions:cachedNaturalDimensions}),naturalDimensions=_useFetchedNaturalDim.naturalDimensions,onError=_useFetchedNaturalDim.onError,error=_useFetchedNaturalDim.error;var concreteDimensions=(0,_useImageConcreteDimensions.default)({flatStyle:flatStyle,naturalDimensions:naturalDimensions,specifiedDimensions:specifiedDimensions,computeMaxWidth:computeMaxWidth,contentWidth:contentWidth});return(0,_getIMGState.getIMGState)({error:error,alt:alt,altColor:altColor,concreteDimensions:concreteDimensions,containerStyle:flatStyle,initialDimensions:initialDimensions,objectFit:objectFit,onError:onError,source:nomalizedSource});}","map":{"version":3,"names":["_react","require","_reactNative","_defaultInitialImageDimensions","_interopRequireDefault","_useIMGNormalizedSource","_useImageConcreteDimensions","_getIMGState","_useImageSpecifiedDimensions","getImageSizeAsync","_ref","uri","headers","Promise","onsuccess","onerror","onImageDimensionsSuccess","width","height","Image","getSizeWithHeaders","getSize","useImageNaturalDimensions","props","source","cachedNaturalDimensions","_ref2","useState","_ref3","_slicedToArray","naturalDimensions","setNaturalDimensions","_ref4","cachedNaturalWidth","cachedNaturalHeight","_ref5","_ref6","error","setError","useEffect","resetOnURIChange","onNaturalDimensions","onError","useFetchedNaturalDimensions","_useImageNaturalDimen","hasCachedDimensions","fetchPhysicalDimensions","cancelled","then","dimensions","catch","e","useIMGElementState","alt","altColor","contentWidth","computeMaxWidth","objectFit","_props$initialDimensi","initialDimensions","default","_ref7","flatStyle","specifiedDimensions","nomalizedSource","_useFetchedNaturalDim","concreteDimensions","getIMGState","containerStyle"],"sources":["/Users/dhavalpatel/Documents/ExpoApp/node_modules/react-native-render-html/lib/commonjs/elements/useIMGElementState.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { Image, ImageURISource } from 'react-native';\nimport {\n  UseIMGElementStateProps,\n  IMGElementState,\n  IncompleteImageDimensions\n} from './img-types';\nimport defaultImageInitialDimensions from './defaultInitialImageDimensions';\nimport useIMGNormalizedSource from './useIMGNormalizedSource';\nimport { ImageDimensions } from '../shared-types';\nimport useImageConcreteDimensions from './useImageConcreteDimensions';\nimport { getIMGState } from './getIMGState';\nimport useImageSpecifiedDimensions from './useImageSpecifiedDimensions';\n\nfunction getImageSizeAsync({\n  uri,\n  headers\n}: {\n  headers: any;\n  uri: string;\n}): Promise<ImageDimensions> {\n  return new Promise<ImageDimensions>((onsuccess, onerror) => {\n    const onImageDimensionsSuccess = (width: number, height: number) =>\n      onsuccess({ width, height });\n    if (headers) {\n      Image.getSizeWithHeaders(uri, headers, onImageDimensionsSuccess, onerror);\n    } else {\n      Image.getSize(uri, onImageDimensionsSuccess, onerror);\n    }\n  });\n}\n\nfunction useImageNaturalDimensions<P extends UseIMGElementStateProps>(props: {\n  cachedNaturalDimensions?: ImageDimensions;\n  source: ImageURISource;\n  specifiedDimensions: IncompleteImageDimensions;\n}) {\n  const { source, cachedNaturalDimensions } = props;\n  const [naturalDimensions, setNaturalDimensions] = useState<\n    P['cachedNaturalDimensions'] extends ImageDimensions\n      ? ImageDimensions\n      : ImageDimensions | null\n  >((cachedNaturalDimensions as any) || null);\n  const { width: cachedNaturalWidth, height: cachedNaturalHeight } =\n    cachedNaturalDimensions || {};\n  const [error, setError] = useState<null | Error>(null);\n  useEffect(\n    function resetOnURIChange() {\n      setNaturalDimensions(\n        (cachedNaturalWidth != null && cachedNaturalHeight != null\n          ? { width: cachedNaturalWidth, height: cachedNaturalHeight }\n          : null) as any\n      );\n      setError(null);\n    },\n    [cachedNaturalHeight, cachedNaturalWidth, source.uri]\n  );\n  return {\n    onNaturalDimensions: setNaturalDimensions,\n    onError: setError,\n    naturalDimensions,\n    error\n  };\n}\n\nfunction useFetchedNaturalDimensions(props: {\n  cachedNaturalDimensions?: ImageDimensions;\n  source: ImageURISource;\n  specifiedDimensions: IncompleteImageDimensions;\n}) {\n  const { source, cachedNaturalDimensions } = props;\n  const { error, naturalDimensions, onError, onNaturalDimensions } =\n    useImageNaturalDimensions(props);\n  const hasCachedDimensions = !!cachedNaturalDimensions;\n  useEffect(\n    function fetchPhysicalDimensions() {\n      let cancelled = false;\n      if (source.uri && !hasCachedDimensions) {\n        getImageSizeAsync({ uri: source.uri, headers: source.headers })\n          .then((dimensions) => !cancelled && onNaturalDimensions(dimensions))\n          .catch((e) => !cancelled && onError(e || {}));\n        return () => {\n          cancelled = true;\n        };\n      }\n    },\n    [\n      source.uri,\n      source.headers,\n      onNaturalDimensions,\n      onError,\n      hasCachedDimensions\n    ]\n  );\n  return {\n    naturalDimensions,\n    error,\n    onError,\n    onNaturalDimensions\n  };\n}\n\n/**\n * This hook will compute concrete dimensions from image natural dimensions and\n * constraints. It will fetch the image and get its dimensions.\n *\n * @remarks If you know the dimensions beforehand, use\n * {@link useIMGElementStateWithCache} instead to save a network request and\n * prevent a layout shift.\n */\nexport default function useIMGElementState(\n  props: UseIMGElementStateProps\n): IMGElementState {\n  const {\n    alt,\n    altColor,\n    source,\n    contentWidth,\n    computeMaxWidth,\n    objectFit,\n    initialDimensions = defaultImageInitialDimensions,\n    cachedNaturalDimensions\n  } = props;\n  const { flatStyle, specifiedDimensions } = useImageSpecifiedDimensions(props);\n  const nomalizedSource = useIMGNormalizedSource({\n    specifiedDimensions,\n    source\n  });\n  const { naturalDimensions, onError, error } = useFetchedNaturalDimensions({\n    source: nomalizedSource,\n    specifiedDimensions,\n    cachedNaturalDimensions\n  });\n  const concreteDimensions = useImageConcreteDimensions({\n    flatStyle,\n    naturalDimensions,\n    specifiedDimensions,\n    computeMaxWidth,\n    contentWidth\n  });\n\n  return getIMGState({\n    error,\n    alt,\n    altColor,\n    concreteDimensions,\n    containerStyle: flatStyle,\n    initialDimensions,\n    objectFit,\n    onError,\n    source: nomalizedSource\n  });\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}