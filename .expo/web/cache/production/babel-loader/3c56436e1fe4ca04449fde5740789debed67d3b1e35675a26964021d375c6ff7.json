{"ast":null,"code":"\"use strict\";var _slicedToArray=require(\"@babel/runtime/helpers/slicedToArray\");var _asyncToGenerator=require(\"@babel/runtime/helpers/asyncToGenerator\");var _loadHTMLResource;Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=SourceLoaderUri;var _react=_interopRequireWildcard(require(\"react\"));var _RenderTTree=_interopRequireDefault(require(\"./RenderTTree\"));var _sourceLoaderContext=_interopRequireDefault(require(\"./context/sourceLoaderContext\"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!==\"function\")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!==\"object\"&&typeof obj!==\"function\"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!==\"default\"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}var ERROR_STATE={error:true,resolvedHTML:null};function loadHTMLResource(_x,_x2){return(_loadHTMLResource=_loadHTMLResource||_asyncToGenerator(function*(uri,_ref){var body=_ref.body,headers=_ref.headers,method=_ref.method;var response=yield fetch(uri,{body:body,headers:headers,method:method});if(response.ok){var html=yield response.text();return{resolvedHTML:html,error:false};}return ERROR_STATE;})).apply(this,arguments);}function useUriSourceLoader(_ref2){var source=_ref2.source,onHTMLLoaded=_ref2.onHTMLLoaded;var _ref3=(0,_react.useState)({error:false,resolvedHTML:null}),_ref4=_slicedToArray(_ref3,2),loadState=_ref4[0],setState=_ref4[1];var error=loadState.error;(0,_react.useEffect)(function(){var cancelled=false;if(!error){setState({error:false,resolvedHTML:null});loadHTMLResource(source.uri,{body:source.body,headers:source.headers,method:source.method}).then(function(state){!cancelled&&setState(state);}).catch(function(){!cancelled&&setState(ERROR_STATE);});}return function(){cancelled=true;};},[error,source.uri,source.body,source.headers,source.method]);(0,_react.useEffect)(function(){loadState.resolvedHTML&&(onHTMLLoaded===null||onHTMLLoaded===void 0?void 0:onHTMLLoaded.call(null,loadState.resolvedHTML));},[loadState.resolvedHTML,onHTMLLoaded]);return loadState;}function SourceLoaderUri(props){var _ref5=(0,_react.useContext)(_sourceLoaderContext.default),remoteErrorView=_ref5.remoteErrorView,remoteLoadingView=_ref5.remoteLoadingView;var _useUriSourceLoader=useUriSourceLoader(props),resolvedHTML=_useUriSourceLoader.resolvedHTML,error=_useUriSourceLoader.error;if(error){return remoteErrorView.call(null,props.source);}if(resolvedHTML===null){return remoteLoadingView.call(null,props.source);}return _react.default.createElement(_RenderTTree.default,{document:resolvedHTML,baseUrl:props.source.uri});}","map":{"version":3,"names":["_react","_interopRequireWildcard","require","_RenderTTree","_interopRequireDefault","_sourceLoaderContext","ERROR_STATE","error","resolvedHTML","loadHTMLResource","_x","_x2","_loadHTMLResource","_asyncToGenerator","uri","_ref","body","headers","method","response","fetch","ok","html","text","apply","arguments","useUriSourceLoader","_ref2","source","onHTMLLoaded","_ref3","useState","_ref4","_slicedToArray","loadState","setState","useEffect","cancelled","then","state","catch","call","SourceLoaderUri","props","_ref5","useContext","default","remoteErrorView","remoteLoadingView","_useUriSourceLoader","createElement","document","baseUrl"],"sources":["/Users/dhavalpatel/Documents/ExpoApp/node_modules/react-native-render-html/lib/commonjs/SourceLoaderUri.tsx"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\nimport { HTMLSourceUri } from './shared-types';\nimport { SourceLoaderProps } from './internal-types';\nimport RenderTTree from './RenderTTree';\nimport sourceLoaderContext from './context/sourceLoaderContext';\n\ninterface LoaderInternalState {\n  error: boolean;\n  resolvedHTML: string | null;\n}\n\nconst ERROR_STATE = {\n  error: true,\n  resolvedHTML: null\n};\n\nasync function loadHTMLResource(\n  uri: string,\n  { body, headers, method }: Omit<HTMLSourceUri, 'uri'>\n): Promise<LoaderInternalState> {\n  const response = await fetch(uri, {\n    body,\n    headers,\n    method\n  });\n  if (response.ok) {\n    const html = await response.text();\n    return {\n      resolvedHTML: html,\n      error: false\n    };\n  }\n  return ERROR_STATE;\n}\n\nexport type UriSourceLoaderProps = {\n  source: HTMLSourceUri;\n} & SourceLoaderProps;\n\nfunction useUriSourceLoader({ source, onHTMLLoaded }: UriSourceLoaderProps) {\n  const [loadState, setState] = useState<LoaderInternalState>({\n    error: false,\n    resolvedHTML: null\n  });\n  const { error } = loadState;\n\n  // Effect to reload on uri changes\n  useEffect(() => {\n    let cancelled = false;\n    if (!error) {\n      setState({ error: false, resolvedHTML: null });\n      loadHTMLResource(source.uri, {\n        body: source.body,\n        headers: source.headers,\n        method: source.method\n      })\n        .then((state) => {\n          !cancelled && setState(state);\n        })\n        .catch(() => {\n          !cancelled && setState(ERROR_STATE);\n        });\n    }\n    return () => {\n      cancelled = true;\n    };\n  }, [error, source.uri, source.body, source.headers, source.method]);\n  useEffect(() => {\n    loadState.resolvedHTML && onHTMLLoaded?.call(null, loadState.resolvedHTML);\n  }, [loadState.resolvedHTML, onHTMLLoaded]);\n  return loadState;\n}\n\nexport default function SourceLoaderUri(props: UriSourceLoaderProps) {\n  const { remoteErrorView, remoteLoadingView } =\n    useContext(sourceLoaderContext);\n  const { resolvedHTML, error } = useUriSourceLoader(props);\n  if (error) {\n    return remoteErrorView.call(null, props.source);\n  }\n  if (resolvedHTML === null) {\n    return remoteLoadingView.call(null, props.source);\n  }\n  return React.createElement(RenderTTree, {\n    document: resolvedHTML!,\n    baseUrl: props.source.uri\n  });\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}